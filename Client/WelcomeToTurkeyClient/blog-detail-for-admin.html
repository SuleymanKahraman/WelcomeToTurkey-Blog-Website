<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <title>ZenBlog Bootstrap Template - Single Post</title>
  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon" />
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500&family=Inter:wght@400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet" />

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
  <link href="assets/vendor/aos/aos.css" rel="stylesheet" />

  <!-- Template Main CSS Files -->
  <link href="assets/css/variables.css" rel="stylesheet" />
  <link href="assets/css/main.css" rel="stylesheet" />

  <style>
    input[type="file"] {
      display: none;
    }

    .custom-file-upload {
      display: inline-block;
      padding: 6px 12px;
      cursor: pointer;
      color: blue;
    }
  </style>
</head>

<body>

  <!-- Modal-Delete-Category -->
  <div class="modal fade" id="modal-delete-blog" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">
            Delete Blog
          </h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this blog?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>
          <button type="button" class="btn btn-danger" id="deleteBlogButton">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
      <a href="" class="logo d-flex align-items-center">
        <h1>WelcomeTOTurkey</h1>
      </a>
      <div class="position-relative">
        <a href="#" class="mx-2"><span class="bi-facebook"></span></a>
        <a href="#" class="mx-2"><span class="bi-twitter"></span></a>
        <a href="#" class="mx-2"><span class="bi-instagram"></span></a>
        <a href="#" class="mx-2 js-search-open"><span class="bi-search"></span></a>
        <i class="bi bi-list mobile-nav-toggle"></i>
        <a href="login.html" class="mx-2"><span class="bi bi-person-circle"></span>
        </a>
        <a href="">
          <div class="dropdown">
            <div id="login" style="display: none">
              <button class="dropbtn"><span id="fName"></span></button>
              <div class="dropdown-content"></div>
            </div>
          </div>
        </a>
        <a class="mx-2" type="button" href="/admin.html">
          Go Back <i class="bi bi-back"></i>
        </a>
        <!-- ======= Search Form ======= -->
        <div class="search-form-wrap js-search-form-wrap">
          <form action="" class="search-form">
            <span class="icon bi-search"></span>
            <input type="text" placeholder="Search" class="form-control" />
            <button class="btn js-search-close">
              <span class="bi-x"></span>
            </button>
          </form>
        </div>
        <!-- End Search Form -->
      </div>
    </div>
  </header>
  <!-- End Header -->

  <main id="main">
    <section class="single-post-content" style="margin-left: 20%">
      <div class="container">
        <div class="row">
          <div class="col-md-9 post-content" data-aos="fade-up">
            <!-- ======= Single Post Content ======= -->
            <form class="form-group" action="blog-detail-for-admin.html" id="blog-guncelle-form">
              <div class="single-post">
                <div class="post">
                  <span class="date" id="category"></span>
                  <span class="mx-1">&colon;</span>
                  <span id="publishDate"></span>
                </div>
                <div>
                  <span>Choose New: </span>
                  <select class="form-select" id="newCategory">
                    <option value=0></option>
                  </select>
                </div>
                <br>
                <div class="col-12 post mb-3">
                  <h1 id="title">Title</h1>
                  <input type="text" class="form-control" id="newTitle" placeholder="insert title...">
                </div>
                <div class="col-12 d-flex flex-column justify-content-center align-items-center">
                  <div style="
                        border: 1px solid rgb(121, 121, 121);
                        width: 95%;
                        height: 250px;
                      " class="d-flex justify-content-center align-items-center">
                    <img src="assets\img\noimage.png" id="photo-display" width="100%" height="100%" />
                  </div>
                  <br />
                  <label class="custom-file-upload">
                    <i class="bi bi-upload"></i>
                    <span>Fotoğraf Yükle</span>
                    <input type="file" id="avatar" name="avatar" style="width: 200px" class="mt-3"
                      accept="image/png, image/jpeg" onchange="onUploadPhoto(event)" />
                  </label>
                </div>
                <br>
                <div class="col-12 d-flex flex-column justify-content-center align-items-center">
                  <h4> <b> INSERT CONTENT OF TITLE </b> </h4>
                  <textarea id="blogContent" style="height: 200px; width: 95%;">
                    Possimus temporibus rerum illo quia repudiandae provident
                    sed quas atque. Ipsam adipisci accusamus iste optio illo
                    aliquam molestias?
                  </textarea>
                </div>
                <div class="text-center">
                  <span id="isPublished"><b>Not Publised</b><span><br>
                      <button type="button" onclick="PublishPost()">Published</button>
                </div>
                <br><br>
                <div class="row">
                  <div class="col-6">
                    <button type="submit" class="btn btn-primary">
                      <i class="bi bi-pencil-fill"></i>
                      Update
                    </button>
                  </div>
                  <div class="col-6 text-end">
                    <button type="button" class="btn btn-danger" onclick="deleteBlog()">
                      <i class="bi bi-trash"></i> Delete
                    </button>
                  </div>
                </div>
              </div>
            </form>
            <!-- End Single Post Content -->

            <!-- ======= Comments ======= -->
            <div class="comments">
              <h5 id="comment-count" class="comment-title py-4">
                Comment Count: 
              </h5>
              <div id="comment-list"></div>
            </div>
            <!-- End Comments -->

            <!-- ======= Comments Form ======= -->
            <div class="row justify-content-center mt-2">
              <div class="col-lg-12">
                <h5 class="comment-title">Leave a Comment</h5>
                <div class="row">
                  <div class="col-12 mb-3">
                    <label for="comment-message">Message</label>

                    <textarea class="form-control" id="comment-message" placeholder="Enter your message" cols="30"
                      rows="10"></textarea>
                  </div>
                  <div class="col-12">
                    <input type="button" class="btn btn-primary" value="Post comment" onclick="SendComment()" />
                  </div>
                </div>
              </div>
            </div>
            <!-- End Comments Form -->
          </div>
        </div>
      </div>
    </section>
  </main>
  <!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="footer-content">
      <div class="container">
        <div class="row g-5">
          <div class="col-lg-4">
            <h3 class="footer-heading">About WelcomeTOTurkey</h3>
            <p>
              "Merhaba! Welcome to our website that provides insights into
              living in Turkey. Our website is designed to cater to people who
              are thinking of living in Turkey or already live here. We offer
              a range of articles covering topics such as culture, history,
              cuisine, and daily life in Turkey. Our aim is to provide a
              comprehensive resource for anyone looking to gain a deeper
              understanding of Turkish society and the unique aspects of
              living in this beautiful country. Join us on this journey to
              explore Turkey and discover everything it has to offer!"
            </p>
            <p>
              <a href="about.html" class="footer-link-more">Learn More</a>
            </p>
          </div>
          <div class="col-6 col-lg-2">
            <h3 class="footer-heading">Navigation</h3>
            <ul class="footer-links list-unstyled">
              <li>
                <a href="index.html"><i class="bi bi-chevron-right"></i> Home</a>
              </li>
              <!-- <li>
                  <a href="index.html"
                    ><i class="bi bi-chevron-right"></i> Blog</a
                  >
                </li> -->
              <li>
                <a href="category.html"><i class="bi bi-chevron-right"></i> Categories</a>
              </li>

              <!-- <li>
                  <a href="single-post.html"
                    ><i class="bi bi-chevron-right"></i> Single Post</a
                  >
                </li> -->
              <li>
                <a href="about.html"><i class="bi bi-chevron-right"></i> About us</a>
              </li>
              <li>
                <a href="contact.html"><i class="bi bi-chevron-right"></i> Contact</a>
              </li>
            </ul>
          </div>
          <div class="col-6 col-lg-2">
            <h3 class="footer-heading">Categories</h3>
            <ul class="footer-links list-unstyled">
              <li>
                <a href="category.html"><i class="bi bi-chevron-right"></i> Entertainment</a>
              </li>
              <li>
                <a href="category.html"><i class="bi bi-chevron-right"></i> History</a>
              </li>
              <li>
                <a href="category.html"><i class="bi bi-chevron-right"></i> Politics</a>
              </li>
              <li>
                <a href="category.html"><i class="bi bi-chevron-right"></i> Science</a>
              </li>
              <li>
                <a href="category.html"><i class="bi bi-chevron-right"></i> Relationship</a>
              </li>
              <li>
                <a href="category.html"><i class="bi bi-chevron-right"></i> Travel</a>
              </li>
            </ul>
          </div>

          <div class="col-lg-4">
            <h3 class="footer-heading">Recent Posts</h3>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-legal">
      <div class="container">
        <div class="row justify-content-between">
          <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
            <div class="copyright">
              © Copyright <strong><span>WelcomeTOTurkey</span></strong>. All Rights Reserved
            </div>
          </div>

          <div class="col-md-6"></div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Vendor JS Files -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

  <script>
    var photo;
    let blogId;
    let isPublished = false;
    const params = new Proxy(new URLSearchParams(window.location.search), {
      get: (searchParams, prop) => searchParams.get(prop),
    });
    if (params.blogId) {
      blogId = params.blogId;
    } else {
      window.location.href = "/admin.html";
    }
    LoadBlogDetail();
    ListOfCategories();
    function LoadBlogDetail() {
      axios
        .get(`https://localhost:7202/api/admin/get-blog-by-Id/${blogId}`)
        .then((response) => {
          if (response.data) {
            let blog = response.data;
            document.getElementById("category").innerHTML = blog.category;
            document.getElementById("title").innerHTML = blog.title;
            document.getElementById("publishDate").innerHTML =
              blog.publishDate === "1.01.0001"
                ? "Not Publised"
                : blog.publishDate;
            if (blog.isPublished) {
              PublishPost();
            }
            document.getElementById("blogContent").innerHTML = blog.content;
            let photo = document.getElementById('photo-display');
            photo.src = blog.photo != null ? "data:image/jpeg;base64," + blog.photo : photo.src;
          }
        });
    }
    function onUploadPhoto(event) {
      let element = document.getElementById("photo-display");
      element.src = URL.createObjectURL(event.target.files[0]);
      photo = event.target.files[0];
    }

    function ListOfCategories() {
      const forBlog = document.getElementById("newCategory");
      axios
        .get(`https://localhost:7202/api/admin/list-category-with-Id`)
        .then((response) => {
          categories = response.data;
          categories.forEach((element) => {
            var option = ``;
            option += `<option value="${element.categoryId}">${element.categoryName}</option>`;
            forBlog.innerHTML += option;
          });
        })
        .catch((error) => {
          alert("Olmadı!!!");
        });
    }

    function PublishPost() {
      isPublished = true;
      const isPublishedSpan = document.getElementById('isPublished');
      isPublishedSpan.innerHTML = '<b>Published</b>';
    }

    const updateForm = document.getElementById("blog-guncelle-form");
    updateForm.addEventListener('submit', function (event) {
      event.preventDefault();
      let updateBlog = new FormData();
      updateBlog.append('BlogId', blogId);
      updateBlog.append('CategoryId', document.getElementById('newCategory').value);
      updateBlog.append('Content', document.getElementById('blogContent').value);
      updateBlog.append('Title', document.getElementById('newTitle').value);
      updateBlog.append('IsPublished', isPublished);
      updateBlog.append('Photo', photo);
      axios.put(`https://localhost:7202/api/admin/update-blog-by-Id`, updateBlog, {
        headers: {
          "Content-Type": "multipart/form-data",
        },
      }).then((response) => {
        if (response) {
          alert(response.data);
          location.reload();
        }
      }).catch((error) => {
        alert(error);
      })

    })



    function deleteBlog() {
      const modalDelete = document.getElementById("modal-delete-blog");
      const modalOpen = new bootstrap.Modal(modalDelete);
      modalOpen.show();

      document.getElementById('deleteBlogButton').addEventListener('click', function () {
        axios
          .delete(`https://localhost:7202/api/admin/delete-blog-by-Id/${blogId}`)
          .then((response) => {

            console.log(response.data);
            debugger;
            if (response) {
              alert(response.data);
              window.location.href = "/admin.html";
            }

          })

      })



    }


  </script>
</body>

</html>