<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <title>ZenBlog Bootstrap Template - Single Post</title>
  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon" />
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500&family=Inter:wght@400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet" />

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
  <link href="assets/vendor/aos/aos.css" rel="stylesheet" />

  <!-- Template Main CSS Files -->
  <link href="assets/css/variables.css" rel="stylesheet" />
  <link href="assets/css/main.css" rel="stylesheet" />

  <!-- Bootstrap.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.min.js"></script>
</head>

<body>
  <!-- Modal-Update-Category-->
  <div class="modal fade" id="modal-update-comment" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">
            Updating Comment
          </h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form class="form-group" action="single-post.html" method="post">
            <div>
              <label for="category">Comment: </label>
            </div>
            <div>
              <input type="text" class="form-control" id="update-comment" placeholder="Enter New Category"
                style="margin-top: 1%" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>
          <button type="submit" class="btn btn-danger" id="confirm-button">
            Update
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center">
        <h1>WelcomeTOTurkey</h1>
      </a>
      <div class="position-relative">
        <nav id="navbar" class="navbar">
          <ul id="category-list">

          </ul>
        </nav>
      </div>
      <div class="d-flex align-items-center mx-3">
        <a href="#" class="mx-2"><span class="bi bi-facebook"></span></a>
        <a href="#" class="mx-2"><span class="bi bi-twitter"></span></a>
        <a href="#" class="mx-2"><span class="bi bi-instagram"></span></a>
        <i class="bi bi-list mobile-nav-toggle"></i>
        <a href="login.html" class="mx-2" id="login-button"><span class="bi bi-door-open"></span></a>
        <a href="#" class="dropdown">
          <div id="login" style="display: none">
            <button class="dropdown button"><span id="fName">sdada</span></button>
            <div class="dropdown-content">
              <button onclick="logout()">Logout</button>
            </div>
          </div>
        </a>
        <a href="/admin.html" style="display: none;" id="adminPageButton">
          <i class="fa-solid fa-right-to-bracket fa-beat"></i></a>
      </div>

    </div>

  </header>
  <!-- End Header -->

  <main id="main">
    <section class="single-post-content" style="margin-left: 20%;">
      <div class="container">
        <div class="row">
          <div class="col-md-9 post-content" data-aos="fade-up">
            <!-- ======= Single Post Content ======= -->
            <form class="form-group" action="single-post.html">
              <div class="single-post">
                <div class="post-meta">
                  <span class="date" id="category">Business</span>
                  <span class="mx-1">&bullet;</span>
                  <span id="publishDate">Jul 5th '22</span>
                </div>
                <h1 class="mb-5" id="title"></h1>
                <img style="padding: 10px;" src="assets\img\noimage.png" id="photo" height="300" width="550" />
                <p id="blogContent" style="text-indent: 2.5rem;">


                </p>
              </div>
            </form>
            <!-- End Single Post Content -->

            <!-- ======= Comments ======= -->
            <div class="comments">
              <h5 id="comment-count" class="comment-title py-4">
                Comment Count:
              </h5>
              <div id="comment-list"></div>
            </div>
            <!-- End Comments -->

            <!-- ======= Comments Form ======= -->
            <div class="row justify-content-center mt-3 d-none" id="login-message">
              <p>
                Yorum yapmak için lütfen
                <a href="/login.html" style="text-decoration: underline">giriş yapınız</a>
              </p>
            </div>
            <div class="row justify-content-center mt-5" id="post-comment-form">
              <div class="col-lg-12">
                <h5 class="comment-title">Leave a Comment</h5>
                <div class="row">
                  <div class="col-12 mb-3">
                    <label for="comment-message">Message</label>

                    <textarea class="form-control" id="comment-message" placeholder="Enter your message" cols="30"
                      rows="10"></textarea>
                  </div>
                  <div class="col-12">
                    <input type="button" class="btn btn-primary" value="Post comment" onclick="SendComment()" />
                  </div>
                </div>
              </div>
            </div>
            <!-- End Comments Form -->
          </div>
        </div>
      </div>
    </section>
  </main>
  <!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="footer-content">
      <div class="container">
        <div class="row g-5">
          <div class="col-lg-4">
            <h3 class="footer-heading">About WelcomeTOTurkey</h3>
            <p>
              "Merhaba! Welcome to our website that provides insights into
              living in Turkey. Our website is designed to cater to people who
              are thinking of living in Turkey or already live here. We offer
              a range of articles covering topics such as culture, history,
              cuisine, and daily life in Turkey. Our aim is to provide a
              comprehensive resource for anyone looking to gain a deeper
              understanding of Turkish society and the unique aspects of
              living in this beautiful country. Join us on this journey to
              explore Turkey and discover everything it has to offer!"
            </p>
          </div>
          <div class="col-6 col-lg-2" style="margin-left: 100px;">
            <h3 class="footer-heading">Navigation</h3>
            <ul class="footer-links list-unstyled" id="category-list-footer">

            </ul>
          </div>
          <div class="col-lg-4" style="margin-left: 80px;">
            <h3 class="footer-heading">Contacts</h3>
            <ul class="contact-info">
              <li><i class="bi bi-envelope"></i> Email: contact@example.com</li>
              <li><i class="bi bi-geo-alt"></i> Address: 1991 Sk. Bağlıca Mh., Ankara, TURKEY</li>
              <li><i class="bi bi-telephone"></i> Phone: 0312 326 98 37</li>
            </ul>
            <div style="margin-left: 30%; margin-top: 20%;">
              <a href="https://twitter.com/example"><i class="bi bi-twitter" style="color: white;"></i></a>
              <a href="https://www.facebook.com/example"><i class="bi bi-facebook" style="color: white;"></i></a>
              <a href="https://plus.google.com/example"><i class="bi bi-google" style="color: white;"></i></a>
            </div>
          </div>
          <div class="footer-legal">
            <div class="container">
              <div class="row justify-content-between">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                  <div class="copyright">
                    © Copyright <strong><span>WelcomeTOTurkey</span></strong>. All Rights Reserved
                  </div>
                </div>
                <div class="col-md-6"></div>
              </div>
            </div>
          </div>
  </footer>


  <!-- Vendor JS Files -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
  <script>
    /* AUTH PROCESS */
    var UId = window.localStorage.getItem("userId");
    var firstName = window.localStorage.getItem("firstName");
    var userType = window.localStorage.getItem('userType');
    var adminPageButton = document.getElementById('adminPageButton');
    var loginButton = document.getElementById("login-button");
    if (userType === 'Admin') {
      adminPageButton.style.display = 'block';
    }
    var login = document.getElementById("login");
    if (firstName) {
      login.style.display = "block";
      document.getElementById("fName").innerHTML = firstName;
      loginButton.style.display = "none";
    } else {
      login.style.display = "none";
    }

    /* Authorizing */
    var token = window.localStorage.getItem("token");
    axios.defaults.headers.common["Authorization"] = `Bearer ${token}`;
    const params = new Proxy(new URLSearchParams(window.location.search), {
      get: (searchParams, prop) => searchParams.get(prop),
    });
    let blogId = params.blogid;

    /* Listing */
    loadCategories();
    LoadComment();
    LoadBlogDetail();
    function LoadBlogDetail() {
      axios
        .get(`https://localhost:7202/api/admin/get-blog-by-Id/${blogId}`)
        .then((response) => {
          if (response) {
            var blog = response.data;
            document.getElementById('category').innerHTML = blog.category;
            document.getElementById('title').innerHTML = blog.title;
            document.getElementById('publishDate').innerHTML = blog.publishDate;
            document.getElementById('blogContent').innerHTML = blog.content;
            let photo = document.getElementById('photo');
            photo.src = blog.photo != null ? "data:image/jpeg;base64," + blog.photo : photo.src;
          }

        });
    }
    function LoadComment() {
      if (UId == null || UId == "") {
        let commentDiv = document.getElementById("post-comment-form");
        let loginMessageDiv = document.getElementById("login-message");
        commentDiv.classList.add("d-none");
        loginMessageDiv.classList.remove("d-none");
      }
      axios
        .get(`https://localhost:7202/api/blog/list-comment/${blogId}`)
        .then((response) => {
          if (response.data.length > 0) {
            let element = document.getElementById("comment-count");
            element.innerHTML += response.data.length;

            let comments = response.data;
            let listElement = document.getElementById("comment-list");
            comments.forEach((comment) => {
              let displayClass = UId != comment.userId ? "d-none" : "";
              listElement.innerHTML += `<div class="comment d-flex mb-4">
                    <div class="flex-shrink-0">
                      <div class="avatar avatar-sm rounded-circle">
                        <img
                          class="avatar-img"
                          src="assets\\img\\free-user-icon-244-thumb.png"
                          alt=""
                          class="img-fluid"
                        />
                      </div>
                    </div>
                    <div class="flex-grow-1 ms-2 ms-sm-3">
                      <div class="comment-meta d-flex align-items-baseline">
                        <h6 class="me-2">${comment.fullName}</h6>
                        <span class="text-muted">${comment.commentDate}</span>
                      </div>
                      <div class="comment-body">
                        ${comment.message}
                      </div>
                      <button class="btn btn-outline-success btn-sm mt-2 ${displayClass}" onclick="UpdateComment(${comment.commentId}, '${comment.message}')">Update</button>
                
                      <button class="btn btn-outline-danger btn-sm mt-2 ${displayClass}" onclick="DeleteComment(${comment.commentId})">Delete</button>

                    </div>
                  </div>`;
            });


          }
        });
    }

    /* Sending comment */
    function SendComment() {
      let value = document.getElementById("comment-message").value;
      let data = {
        UserId: UId,
        Message: value,
        BlogId: blogId,
      };
      axios
        .post("https://localhost:7202/api/blog/add-comment", data)
        .then((response) => {
          if (response) {
            window.location.reload();
          }
        })
        .catch((error) => {
          console.log(error);
        });
    }

    /* Update Comment */

    function UpdateComment(Id, message) {
      let commentId = Id;
      let commentInput = document.getElementById("update-comment");
      commentInput.value = message;
      let modal = document.getElementById("modal-update-comment");
      let bootModal = new bootstrap.Modal(modal);
      bootModal.show();

      document
        .getElementById("confirm-button")
        .addEventListener("click", function () {
          const newComment = {
            message: commentInput.value,
            commentId: commentId,
          };
          axios
            .put(`https://localhost:7202/api/blog/update-comment`, newComment)
            .then((response) => {
              if (response) {
                alert("The comment has just been updated...");
                location.reload();
              }
            });
        });
    }

    /* Delete Comment By Id */
    function DeleteComment(commentId) {
      axios
        .delete(`https://localhost:7202/api/blog/delete-comment/${commentId}`)
        .then((response) => {
          if (response) {
            window.location.reload();
          }
        });
    }

    /* Logout */
    function logout() {
      window.localStorage.clear();
      login.style.display = "none";
      adminPageButton.style.display = "none";
      window.location.reload();
    }

    function loadCategories() {
      const listElement = document.getElementById("category-list");
      const listForFooter = document.getElementById('category-list-footer');

      axios
        .get(`https://localhost:7202/api/admin/list-category-with-Id`)
        .then((response) => {
          categories = response.data;
          categories.forEach((element) => {
            listElement.innerHTML += `<li><a href="category.html?categoryId=${element.categoryId}">${element.categoryName}</a></li>`
            listForFooter.innerHTML += `<li><a href="category.html?categoryId=${element.categoryId}">${element.categoryName}</a></li>`
          });
        })
        .catch((error) => {
          console.log(error);
          alert("Do Not Happen!!!");
        });
    }
  </script>
</body>

</html>